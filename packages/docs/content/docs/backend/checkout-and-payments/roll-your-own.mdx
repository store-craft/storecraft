# Roll Your Own **Payment Gateway**

You can and encouraged to write your own favourite Payment Gateway Integration.

It is Easy !!!

This article will teach you,
- The concepts of implemeting a payment integration
- The code required

> You are advised to pick the code of `@storecraft/payments-dummy` and `@storecraft/payments-paypal-standard`

## Concepts

### onCheckoutCreate Hook

The most important **hook**, that a payment gateway implements is the `onCheckoutCreate` hook.
This hook roughly is an async function, that recieves [OrderData]() and creates a payment
intent in the payment gateway servers (stripe, paypal etc..).

The method has to return a value, that will help it to identify the payment in future interactions.
`storecraft` will save this value and present it to the gateway everytime it talks with it.

### onCheckoutComplete Hook (synchronous payment)

`onCheckoutComplete` purpose is to confirm a verified payment method and intent.
This happens in synchronous payments scenarios.

The client is presented with credit card (payment method) form and confirms,
this triggers a confirmation at the backend.

`onCheckoutComplete` should return the new [OrderData]() Status (checkout and payment status),
which is then reflected at the order data.

### webhook (asynchronous payment)

> Work In Progress

### status method

At every moment, the gateway should be able to send back,
- A formatted text readable text about the status of the payment
- A list of eligible actions, that a client can invoke with regards to an order.


### Actions

Each gateway can publish a list of **Actions** it supports

For example, a credit card processor, may publish
- `capture`
- `void`
- `refund`

Also, the gateway provides an interface called `invokeAction` so users can
invoke actions directly based on the supported and published actions list.

## Code

In this section, we will explore the interface and implement a dummy payment integration

### The Interface

Every Gateway should implement the following interface found at

```
import('@storecraft/core/v-payments').payment_gateway<>
```

Which is

```ts
import type { 
  OrderData, PaymentGatewayAction, PaymentGatewayInfo, PaymentGatewayStatus 
} from "../v-api/types.api.js";

export type PaymentGatewayActionHandler<CreateResult, Extra> = (input: CreateResult, extra: Extra) => Promise<PaymentGatewayStatus>;


export type OnCheckoutCompleteResult = Partial<Omit<OrderData["status"], "fulfillment">>;


/**
 * @template {any} Config The config type
 * @template {any} CreateResult The result of checkout creation type
 */
export declare interface payment_gateway<Config, CreateResult> {

  info: PaymentGatewayInfo;

  config: Config;

  actions: PaymentGatewayAction[];

  invokeAction<E extends any=any>(action_handle: string): PaymentGatewayActionHandler<CreateResult, E>;

  onCheckoutCreate: (order: OrderData) => Promise<CreateResult>;

  onCheckoutComplete: (create_result: CreateResult, extra_client_payload: any) => Promise<OnCheckoutCompleteResult>;

  status: (checkout_create_result: CreateResult) => Promise<PaymentGatewayStatus>;

  webhook?: (input: Request) => Promise<void>;
}
```